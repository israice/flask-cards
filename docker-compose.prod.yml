services:
  flask_app:
    build:
      context: ./
      dockerfile: Dockerfile
    container_name: flask_app
    command: python run.py
    volumes:
      - ./:/app
    ports:
      - "5002:5002"
    env_file:
      - ${ENV_FILE_PATH:-./.env}
    environment:
      - FLASK_ENV=production
    networks:
      - pc2-net
    restart: unless-stopped

  webhook:
    build:
      context: ./core/TOOLS/AUTOUPDATE_WEBHOOK_FROM_GITHUB
      dockerfile: Dockerfile
    volumes:
      - ./:/app
      - /var/run/docker.sock:/var/run/docker.sock # Access to Docker daemon
    ports:
      - "9002:9002"
    environment:
      - AUTOUPDATE_WEBHOOK_FROM_GITHUB=${AUTOUPDATE_WEBHOOK_FROM_GITHUB}
      - HOST_PROJECT_DIR=${HOST_PROJECT_DIR:-/home/administrator/projects/nakama}
    networks:
      - pc2-net
    restart: unless-stopped

networks:
  pc2-net:
    external: true
    name: pc2-net
